/**
 * @name index.js<beez-touch/s>
 * @author Masaki Sueda <s.masaki07@gmail.com>
 * @overview Touch event plug-in for Beez (browser)
 * @license MIT
 */

var BEEZ_TOUCH_VERSION="0.2.3";"undefined"!=typeof module&&module.exports?exports.VERSION=BEEZ_TOUCH_VERSION:!function(){define("beez.touch",["require","exports","module","beez"],function(t){var e=t("beez"),a=e.getLogger("beez.touch");if(e.touch)return a.warn("beez.touch is already loaded."),e.touch;var h=e.vendor._,s=e.vendor.$,c="ontouchstart"in window,i=function(t){return c?t.originalEvent?t.originalEvent.touches[0]||t.originalEvent.changedTouches[0]:t.changedTouches[0]:t},n=e.View.extend("beez.Touch",{initialize:function(t){n.__super__.initialize.apply(this,arguments),t=t||{},t.bztch=t.bztch||{},this._bztchTaps=null,this._bztchIsTappable=!1,this._bztchIsTapMouseDown=!1,this._bztchPrefix=h.isString(t.bztch.prefix)?t.bztch.prefix:"bztch",this._bztchTapPrefix=this._bztchPrefix+"-tap",this._bztchTapHoverClassName="string"==typeof t.bztch.hoverClassName?t.bztch.hoverClassName:"hover",this._bztchTapLockedClassName="string"==typeof t.bztch.lockedClassName?t.bztch.lockedClassName:"locked",this._bztchPreventDefault=t.preventDefault||!1,this._bztchStartPosition={},this._bztchThreshold=t._bztchThreshold||10},tap:function(t,e,a,s){var i,n,o,l,p,b,r;if(h.isArray(t)&&t.length>1)return void h.each(t,function(h,c){this.tap(t.eq(c),e,a,s)},this);if(!this._bztchTaps){i={},c?(i["touchstart ."+this._bztchTapPrefix]="onBztchTapStart",i["touchmove ."+this._bztchTapPrefix]="onBztchTapMove",i["touchend ."+this._bztchTapPrefix]="onBztchTapEnd",i["touchcancel ."+this._bztchTapPrefix]="onBztchTapCancel"):(i["mousedown ."+this._bztchTapPrefix]="onBztchTapMouseDown",i["mousemove ."+this._bztchTapPrefix]="onBztchTapMouseMove",i["mouseup ."+this._bztchTapPrefix]="onBztchTapMouseUp",i["mouseleave ."+this._bztchTapPrefix]="onBztchMouseLeave");for(n in i)o=this[i[n]],l=n.match(/^(\S+)\s*(.*)$/),p=l[1],b=l[2],o=h.bind(o,this),p+=".delegateEvents"+this.cid,t===this.$el?this.$el.on(p,o):this.$el.on(p,b,o);this._bztchTaps={}}r=h.uniqueId(this._bztchTapPrefix+"-"),this._bztchTaps[r]={callback:e,callbackStart:s?h.isFunction(s.tapStart)?s.tapStart:null:null,callbackMove:s?h.isFunction(s.tapMove)?s.tapMove:null:null,callbackEnd:s?h.isFunction(s.tapEnd)?s.tapEnd:null:null,callbackCancel:s?h.isFunction(s.tapCancel)?s.tapCancel:null:null,context:a},t.addClass(this._bztchTapPrefix),t.attr("data-"+this._bztchTapPrefix+"Uid",r)},onBztchTapStart:function(t){var e,a=s(t.currentTarget);t=i(t),e=this.bztchGetId(a),e&&(this._bztchPreventDefault&&t.preventDefault(),this._bztchStartPosition={x:t.pageX,y:t.pageY},a.hasClass(this._bztchTapLockedClassName)||(this._bztchIsTappable=!0,this._bztchTaps[e].callbackStart&&this._bztchTaps[e].callbackStart.call(this._bztchTaps[e].context,t),a.addClass(this._bztchTapHoverClassName)))},onBztchTapMove:function(t){var e,a=s(t.currentTarget);t=i(t),e=this.bztchGetId(a),e&&(this._bztchPreventDefault&&t.preventDefault(),this._bztchTaps[e].callbackMove&&this._bztchTaps[e].callbackMove.call(this._bztchTaps[e].context,t),(Math.abs(t.pageX-this._bztchStartPosition.x)>this._bztchThreshold||Math.abs(t.pageY-this._bztchStartPosition.y)>this._bztchThreshold)&&(this._bztchIsTappable=!1,a.removeClass(this._bztchTapHoverClassName)))},onBztchTapEnd:function(t){var e,a=s(t.currentTarget);if(t=i(t),e=this.bztchGetId(a)){if(this._bztchPreventDefault&&t.preventDefault(),this._bztchIsTappable&&!a.hasClass(this._bztchTapLockedClassName)){if(this._bztchTaps[e].callback&&this._bztchTaps[e].callback.call(this._bztchTaps[e].context,t),!this._bztchTaps)return;this._bztchTaps[e].callbackEnd&&this._bztchTaps[e].callbackEnd.call(this._bztchTaps[e].context,t)}this._bztchIsTappable=!1,a.removeClass(this._bztchTapHoverClassName)}},onBztchTapCancel:function(t){var e,a=s(t.currentTarget);t=i(t),e=this.bztchGetId(a),e&&(this._bztchTaps[e].callbackCancel&&this._bztchTaps[e].callbackCancel.call(this._bztchTaps[e].context,t),this._bztchIsTappable=!1,a.removeClass(this._bztchTapHoverClassName))},onBztchTapMouseDown:function(t){this._bztchIsTapMouseDown=!0,t.touches=[{}],t.touches[0].clientX=arguments[0].clientX,t.touches[0].clientY=arguments[0].clientY,this.onBztchTapStart.apply(this,arguments)},onBztchTapMouseMove:function(t){this._bztchIsTapMouseDown&&(t.touches=[{}],t.touches[0].clientX=t.clientX,t.touches[0].clientY=t.clientY,this.onBztchTapMove.apply(this,arguments))},onBztchTapMouseUp:function(t){this._bztchIsTapMouseDown=!1,t.touches=[{}],t.touches[0].clientX=t.clientX,t.touches[0].clientY=t.clientY,this.onBztchTapEnd.apply(this,arguments)},onBztchMouseLeave:function(){this._bztchIsTapMouseDown=!1,this.onBztchTapCancel.apply(this,arguments)},bztchGetId:function(t){return t.attr("data-"+this._bztchTapPrefix+"Uid")},dispose:function(){h.each(this._bztchTaps,function(t,e){delete this._bztchTaps[e].callback,delete this._bztchTaps[e].callbackStart,delete this._bztchTaps[e].callbackMove,delete this._bztchTaps[e].context,delete this._bztchTaps[e]},this),delete this._bztchTaps,delete this._bztchIsTappable,delete this._bztchIsTapMouseDown,delete this._bztchPrefix,delete this._bztchTapPrefix,delete this._bztchTapHoverClassName,delete this._bztchTapLockedClassName,delete this._bztchStartPosition,n.__super__.dispose.apply(this,arguments)}});return e.touch={View:n},e.touch})}(this);